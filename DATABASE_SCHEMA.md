# KeyBase Database Schema Documentation

## Database Reset Completed
**Date:** October 29, 2025

---

## Database Structure

### Table: `duplicator`

The main table for storing key management records with the following optimized schema:

#### Primary Key
- `duplicator_id` (INT, AUTO_INCREMENT) - Unique identifier for each record

#### Required Fields (NOT NULL)
These fields must be provided when creating a new record:

1. **name** (VARCHAR(100)) - Customer name
2. **phone_number** (VARCHAR(15)) - Customer contact number (must be 10 digits)
3. **id_no** (VARCHAR(50)) - Customer ID/Aadhar number

#### Optional Fields (Nullable)
These fields can be left empty:

1. **vehicle_type** (VARCHAR(20)) - Type of vehicle (Car, Bike, Scooter, etc.)
2. **vehicle_no** (VARCHAR(20)) - Vehicle registration number
3. **key_no** (VARCHAR(50)) - Key number/identifier
4. **key_type** (VARCHAR(50)) - Purpose of key (Home, Office, Locker, Department, Suspicious)
5. **date_added** (DATE) - Date when record was added
6. **remarks** (VARCHAR(500)) - Additional notes/comments
7. **quantity** (INT, DEFAULT 1) - Number of keys
8. **amount** (DECIMAL(10,2), DEFAULT 0.00) - Amount charged
9. **image_path** (VARCHAR(255)) - Path to customer photo

#### Audit Fields
- **created_at** (TIMESTAMP) - Record creation timestamp
- **updated_at** (TIMESTAMP) - Last update timestamp

---

## Database Indexes

For optimized search performance, the following indexes are created:

1. `idx_phone_number` - Index on phone_number field
2. `idx_id_no` - Index on id_no field
3. `idx_key_no` - Index on key_no field
4. `idx_vehicle_no` - Index on vehicle_no field
5. `idx_name` - Index on name field

---

## Changes Made

### 1. **Removed Unnecessary NOT NULL Constraints**
   - `vehicle_type` - Changed to nullable (optional)
   - `vehicle_no` - Already nullable
   - `key_no` - Changed to nullable (optional)

### 2. **Updated Required Fields**
   Only 3 fields are now mandatory:
   - Name
   - Phone Number
   - ID Number

### 3. **Database Reset**
   - Deleted old database file: `data/keybase.mv.db`
   - Deleted sample data file: `config/sample_data.sql`
   - Recreated database with new optimized schema
   - All old records have been removed

### 4. **Added New Indexes**
   - Added index on `phone_number` for faster customer lookup
   - Added index on `name` for faster name-based searches

---

## Field Validation Rules

### Name
- **Required:** Yes
- **Cannot be empty**

### Phone Number
- **Required:** Yes
- **Must be exactly 10 digits**
- **Cannot be empty**

### ID Number
- **Required:** Yes
- **Cannot be empty**

### All Other Fields
- **Optional:** Can be left empty or null
- **No validation constraints**

---

## Database Files Location

- **Database File:** `e:\KeyBase\data\keybase.mv.db`
- **H2 Schema:** `e:\KeyBase\config\init_h2_database.sql`
- **MySQL Schema:** `e:\KeyBase\config\init_database.sql`

---

## Backup Recommendations

To backup your data:
1. Copy the `data/keybase.mv.db` file to a safe location
2. Copy the `images/` directory if you have customer photos

To restore:
1. Close the KeyBase application
2. Replace `data/keybase.mv.db` with your backup file
3. Replace the `images/` directory
4. Restart the application

---

## Database Type

**Current Configuration:** H2 Database (File-based)
- **Advantages:** 
  - No separate database server required
  - Fast and lightweight
  - Embedded with the application
  - Easy to backup (single file)

**Connection String:** `jdbc:h2:./data/keybase;AUTO_SERVER=TRUE`

---

*Generated by KeyBase Database Management System*
